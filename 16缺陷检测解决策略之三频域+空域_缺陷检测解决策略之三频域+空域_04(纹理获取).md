## 缺陷检测解决策略之三频域+空域_04(纹理获取)


![在这里插入图片描述](https://i-blog.csdnimg.cn/direct/db16660aa510455182792f383de6bd6d.png)

```cpp
* 读取图像
read_image (Image, 'plan_01')

* 导向滤波
*Image 输入图像
* 方向指导图像
* 输出图像
* 滤波窗口的半径，平滑效果越强，越模糊
* 正则化参数，平滑强度，值越大，平滑效果越强，越模糊

gen_image_proto (Image, ImageCleared, 0)

* 低通滤波：增强背景，突出背景，弱化边缘
guided_filter (Image, ImageCleared, ImageGuided, 1.5,15)

* 差分思想
sub_image (Image, ImageGuided, ImageSub, 1, 128)

* 和傅里叶变换+低通滤波，有了一样的效果
```

```cpp
***
* 用导向滤波获取纹理
***

* 设置窗口
dev_update_off ()
dev_close_window ()
NumImages := 2
for Index := 1 to NumImages by 1
    * 读取图像
    read_image (Image, 'plan_' + Index$'02')
    * 设置窗口显示
    dev_open_window_fit_image (Image, 0, 0, -1, -1, WindowHandle)
    set_display_font (WindowHandle, 14, 'mono', 'true', 'false')
    dev_display (Image)
    disp_message (WindowHandle, 'Original image', 'window', 12, 12, 'black', 'true')
    * 获取窗口的大小和位置
    get_window_extents (WindowHandle, Row, Column, Width, Height)
    * 设置窗口显示
    dev_open_window_fit_image (Image, 0, Width + 8, -1, -1, WindowHandle1)
    set_display_font (WindowHandle1, 14, 'mono', 'true', 'false')
    dev_open_window_fit_image (Image, 0, 2 * Width + 16, -1, -1, WindowHandle2)
    set_display_font (WindowHandle2, 14, 'mono', 'true', 'false')
    * 生成一个灰度值为0的图像
    gen_image_proto (Image, ImageStructure, 0)
    for Index1 := 1 to 3 by 1
        * 导向滤波
        guided_filter (Image, ImageStructure, ImageStructure, 1.5, 15)
    endfor
    * 图像相减获取纹理
    sub_image (Image, ImageStructure, ImageTexture, 1, 128)
    * 显示结果
    dev_set_window (WindowHandle)
    dev_display (Image)
    disp_message (WindowHandle, 'Original image ' + Index, 'window', 12, 12, 'black', 'true')
    dev_set_window (WindowHandle1)
    dev_display (ImageStructure)
    disp_message (WindowHandle1, 'Filtered image', 'window', 12, 12, 'black', 'true')
    dev_set_window (WindowHandle2)
    dev_display (ImageTexture)
    disp_message (WindowHandle2, 'Extracted texture', 'window', 12, 12, 'black', 'true')
    if (Index < NumImages)
        disp_continue_message (WindowHandle2, 'black', 'true')
        stop ()
        dev_close_window ()
        dev_close_window ()
        dev_close_window ()
    endif
endfor


```
在Halcon中，`guided_filter (Image, Image, ImageGuided, 3, 20)` 是导向滤波（Guided Filter）操作符的应用，主要用于图像平滑、边缘保持和细节增强等任务。以下是该操作符的详细作用及参数解释：

---

### **1. 导向滤波的作用**
导向滤波是一种基于局部线性模型的滤波方法，通过一张引导图像（可以是输入图像本身或其他图像）对目标图像进行滤波处理。其核心特点包括：
- **边缘保持**：在平滑图像的同时，能够保留图像中的边缘和细节信息。
- **纹理传递**：当引导图像与目标图像不同时，可以将引导图像的纹理结构传递到目标图像中。
- **计算效率高**：相比双边滤波，导向滤波的计算复杂度更低，适合实时处理。

在 `guided_filter (Image, Image, ImageGuided, 3, 20)` 中，由于引导图像和目标图像相同（均为 `Image`），因此该操作主要用于**保边平滑**，即去除噪声的同时保留边缘信息。

---

### **2. 参数解释**
`guided_filter (Image, ImageGuide, ImageGuided, Radius, Amplitude)` 的参数含义如下：

| **参数**       | **含义**                                                                 | **示例值（当前调用）** |
|----------------|--------------------------------------------------------------------------|------------------------|
| `Image`        | 输入图像（目标图像），即需要进行滤波处理的图像。                           | `Image`（输入图像）    |
| `ImageGuide`   | 引导图像，用于指导滤波过程。可以是输入图像本身，也可以是其他图像。           | `Image`（与输入图像相同） |
| `ImageGuided`  | 输出图像，即滤波后的结果图像。                                           | `ImageGuided`          |
| `Radius`       | 滤波窗口半径，决定滤波时考虑的邻域大小。半径越大，平滑效果越强，但可能丢失更多细节。 | `3`                    |
| `Amplitude`    | 正则化参数（或称为平滑强度），控制边缘保持与平滑之间的平衡。值越大，平滑效果越强，但边缘可能模糊。 | `20`                   |

#### **参数说明**
- **`Radius`（滤波窗口半径）**：
  - 定义了滤波时考虑的邻域范围。例如，`Radius=3` 表示滤波窗口为 `7x7`（因为窗口直径为 `2*Radius+1`）。
  - 较大的 `Radius` 会增强平滑效果，但可能导致边缘模糊；较小的 `Radius` 能更好地保留细节，但平滑效果较弱。

- **`Amplitude`（正则化参数）**：
  - 控制滤波的强度。值越大，平滑效果越强，但可能丢失更多边缘细节；值越小，边缘保持越好，但平滑效果较弱。
  - 通常需要根据图像噪声水平和边缘强度进行调整。

---

### **3. 示例代码解析**
```halcon
guided_filter (Image, Image, ImageGuided, 3, 20)
```
- **输入**：`Image`（待滤波图像）。
- **引导图像**：`Image`（与输入图像相同，用于保边平滑）。
- **输出**：`ImageGuided`（滤波后的图像）。
- **参数**：
  - `Radius=3`：滤波窗口半径为 3，即窗口大小为 `7x7`。
  - `Amplitude=20`：正则化参数为 20，控制平滑强度。

---

### **4. 应用场景**
导向滤波在以下场景中非常有用：
- **图像去噪**：在去除噪声的同时保留边缘信息。
- **细节增强**：通过选择合适的引导图像，可以增强图像的细节。
- **HDR压缩**：在处理高动态范围图像时，可以平衡亮区和暗区的细节。
- **图像抠图**：在图像分割中，导向滤波可以用于平滑边缘并去除噪声。

---

### **5. 参数调整建议**
- **`Radius`**：
  - 对于细节丰富的图像，可以选择较小的 `Radius`（如 1 或 2）。
  - 对于噪声较多的图像，可以选择较大的 `Radius`（如 5 或 10）。
- **`Amplitude`**：
  - 对于强边缘图像，可以选择较小的 `Amplitude`（如 10 或 20）。
  - 对于弱边缘图像，可以选择较大的 `Amplitude`（如 50 或 100）。

---

### **总结**
`guided_filter (Image, Image, ImageGuided, 3, 20)` 的作用是对输入图像 `Image` 进行保边平滑处理，输出结果存储在 `ImageGuided` 中。参数 `Radius=3` 和 `Amplitude=20` 分别控制滤波窗口大小和平滑强度。通过调整这些参数，可以在平滑图像和保留边缘之间找到平衡，适用于多种图像处理任务。
