```cpp
***
*
* 二 训练模型
*
***

* 选择训练模型
if(0)   
    Train_Image_Directory:='MLP_粗糙度小批量精确数据集/trainData/直边'
    MLPHandle_Name:='Line_MLP_Model.gmc'
else
    Train_Image_Directory:='MLP_粗糙度小批量精确数据集/trainData/R角'
    MLPHandle_Name:='R_MLP_Model.gmc'
endif

* 遍历得到所有的目录Files
list_files (Train_Image_Directory, 'directories', Files)
* 计算目录数
tuple_length (Files, Length)
* 创建MLP模型

create_class_mlp(180, 50, 5, 'softmax', 'normalization', 10, 42, MLPHandle)
* 类别名
ClassName:=['A','B','C','D','E']
* 设置绘画模式
dev_set_draw ('margin')

* 遍历所有的目录
for i := 0 to Length-1 by 1
    * 遍历得到每个目录类别中所有的图像路径
    list_image_files (Files[i], 'default', [], ImageFiles)
    * 计算图像数量
    tuple_length (ImageFiles, Length1)
    * 分割目录路径
    tuple_split ( Files[i], '\\', Substrings)
    * 获取分割长度
    tuple_length (Substrings, SubstringsLen)
    * 获取分割最后一个字符串，即目录明，即类别名
    tuple_split (Substrings[SubstringsLen-1], '无效参数', FileName)
    * 遍历单个目录类别下所有的图像
    for Index := 0 to Length1-1 by 1              
        * 读取图像

        read_image (Image, ImageFiles[Index]) 
        *显示图像
        dev_close_window ()
        dev_open_window_fit_image(Image, 0, 0, -1, -1, WindowHandle)       
        dev_display (Image)
        * 生成特征向量         

        gen_features (Image, FeatureVector)
        * 判别当前是遍历什么目录，得到类别                        
        if(FileName=='A')                   
            iGrade:=0               
        elseif(FileName=='B')              
            iGrade:=1                                 
        elseif(FileName=='C')             
            iGrade:=2                               
        elseif(FileName=='D')           
            iGrade:=3                               
        elseif(FileName=='E')             
            iGrade:=4             
        endif
        * 加入训练样本     
        add_sample_class_mlp (MLPHandle, FeatureVector, iGrade)               
    endfor                                    
endfor
* 训练MLP模型
train_class_mlp (MLPHandle, 500, 1, 0.000001, Error, ErrorLog)  
* 保存模型
write_class_mlp (MLPHandle, Train_Image_Directory +'/' + MLPHandle_Name)


**************************************************************
clear_class_mlp (MLPHandle)

dev_get_window (WindowHandle)
set_tposition (WindowHandle, 24, 12)
set_display_font (WindowHandle, 30, 'mono', 'true', 'false')
write_string (WindowHandle, MLPHandle_Name+'模型训练结束')
stop()










```

