

```csharp
* 1.获取窗口

dev_get_window (WindowHandle)

* 2. 读取标准图像
read_image (Image1, 'C:/Users/Jumy/Desktop/Halcon-AOI教学资料/Halcon-AOI教学资料/程序与图像/06几何定位/2.几何定位/图片/1.bmp')
* 3. 绘制做模板的区域
draw_rectangle1 (WindowHandle, Row1, Column1, Row2, Column2)
* 4.生成区域
gen_rectangle1 (Rectangle, Row1, Column1, Row2, Column2)
* 5.获取对应区域的图像
reduce_domain (Image1, Rectangle, ImageReduced)
* 区域图像做一个模板
create_shape_model (ImageReduced, 'auto', -0.39, 0.79, 'auto', 'auto', 'use_polarity', 'auto', 'auto', ModelID)
get_shape_model_contours (ModelContours, ModelID, 1)

* ROI区域不变，变换图像

** 确定检测区域

draw_circle (WindowHandle, Row, Column, Radius)
gen_circle (Circle, Row, Column, Radius)

* 新图像，盖子在新的位置
read_image (Image2, 'C:/Users/Jumy/Desktop/Halcon-AOI教学资料/Halcon-AOI教学资料/程序与图像/06几何定位/2.几何定位/图片/2.bmp')

* 图像不变，变ROI（ROI跟随），变换仿射变换矩阵的生成上

find_shape_model (Image2, ModelID, -0.39, 0.79, 0.5, 1, 0.5, 'least_squares', 0, 0.9, Row3, Column3, Angle, Score)
* （模板匹配点到原ROI点）
vector_angle_to_rigid (Row3, Column3, 0, Row, Column, 0, HomMat2D)

affine_trans_image (Image2, ImageAffineTrans, HomMat2D, 'constant', 'false')


```

```csharp

*******************************
* 三 ROI不变，平移图像
* 几何模板匹配定位
*******************************


dev_set_draw('margin')
read_image (Image, './图片/1.bmp')
* draw_rectangle1(3600, Row1, Column1, Row2, Column2)
gen_rectangle1(Rectangle, 848, 237, 1001, 941)
* draw_circle(3600, Row, Column, Radius)
gen_circle(Circle, 544, 564, 241)
reduce_domain(Image, Circle, ImageReduced)
create_shape_model(ImageReduced, 'auto', 0, 0, 'auto', 'auto', 'use_polarity', 'auto', 'auto', ModelID)
get_shape_model_contours(ModelContours, ModelID, 1)

* Code generated by Image Acquisition 01
list_files ('./图片', ['files','follow_links'], ImageFiles)
tuple_regexp_select (ImageFiles, ['\\.(tif|tiff|gif|bmp|jpg|jpeg|jp2|png|pcx|pgm|ppm|pbm|xwd|ima)$','ignore_case'], ImageFiles)
for Index := 0 to |ImageFiles| - 1 by 1
    read_image (Image, ImageFiles[Index])
    * 模板匹配
    find_shape_model(Image, ModelID, 0, 0, 0.5, 1, 0.5, 'least_squares', 0, 0.9, Row3, Column3, Angle, Score)
    if(|Score|>0)
        dev_display_shape_matching_results(ModelID, 'red', Row3, Column3, Angle, 1, 1, 0)
       *ROI跟随
       area_center(Circle, Area, Row4, Column4)
       
        vector_angle_to_rigid( Row3, Column3, 0,Row4, Column4, 0, HomMat2D)
       affine_trans_image(Image, ImageAffinTrans, HomMat2D, 'constant', 'false')
        dev_display(Rectangle)
        
    endif
    
    stop()
    
endfor


*******************************
* 四 ROI不变，平移图像
* Blob定位
*******************************


read_image (Image, './图片/1.bmp')
threshold(Image, Region, 200, 255)
connection(Region, ConnectedRegions)
fill_up(ConnectedRegions, RegionFillUp)
select_shape (RegionFillUp, SelectedRegions, ['circularity','outer_radius'], 'and', [0.7,150], [1,250])
area_center(SelectedRegions, Area1, Row0, Column0)
gen_cross_contour_xld(Cross, Row0, Column0, 30, Angle)

* 获取所有图像
list_files ('./图片', ['files','follow_links'], ImageFiles)
tuple_regexp_select (ImageFiles, ['\\.(tif|tiff|gif|bmp|jpg|jpeg|jp2|png|pcx|pgm|ppm|pbm|xwd|ima)$','ignore_case'], ImageFiles)
for Index := 0 to |ImageFiles| - 1 by 1
    read_image (Image, ImageFiles[Index])
    * 阈值分割
   threshold(Image, Region, 220, 255)
   connection(Region, ConnectedRegions)
    fill_up(ConnectedRegions, RegionFillUp)
   dev_display(Image)
   select_shape (RegionFillUp, SelectedRegions, ['circularity','outer_radius'], 'and', [0.7,150], [1,250])
    area_center(SelectedRegions, Area1, Row1, Column1)
    gen_cross_contour_xld(Cross, Row1, Column1, 30, Angle)
    if(|Row1|>0)
      
     
        vector_angle_to_rigid( Row1, Column1,0,Row0, Column0,  0, HomMat2D)
       affine_trans_image(Image, ImageAffinTrans, HomMat2D, 'constant', 'false')
        dev_display(Rectangle)
        
    endif
    
    stop()
    
endfor


```

